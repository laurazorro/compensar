
    <!-- Custom styles for this template-->
    <link href="../css/main.css" rel="stylesheet">
    <link href="../css/vu.sop.ui.css" rel="stylesheet">
<style>
body{
    background: #f4f6f6 ;
}
#vu\.sop {
    background-color: white;
}
#vu\.sop\.ui\.videoContainer {
    background-color: white;
}
</style>

<script>
    function alerta(){
        Swal.fire({
            html: "<small class='text-muted'>El numero del formulario de registro no coincide con el numero del documento</small>",
            imageUrl: "../../media/logo_compensar.png",
            confirmButtonText: "Volver"
        });

    }
</script>
<div class="container">
    <div class="card position-absolute top-50 start-50 translate-middle col-lg-6 col-md-8 col-11">
        <div class="card-body">
            <button type="button" class="btn-close" aria-label="Close" onclick=" location.href='../index.html'"></button>
            <h3 class="card-title text-center"><img src="../media/logo_compensar.png" class="logo"></h3>
            <div class="row">
                <div id="vu.sop" >
                    <div id="vu.sop.ui" >
                        <div id="vu.sop.ui.whiteLoading" class="vu.sop.ui.fullSizeDiv" style="display: block">
                            <div class="vu.sop.ui.innerVerticalAlign">
                                <img class="vu.sop.ui.loadingImg" src="data:image/svg+xml;base64,PHN2ZyBhcmlhLWhpZGRlbj0idHJ1ZSIgZm9jdXNhYmxlPSJmYWxzZSIgZGF0YS1wcmVmaXg9ImZhcyIgZGF0YS1pY29uPSJjb2ciIGNsYXNzPSJzdmctaW5saW5lLS1mYSBmYS1jb2cgZmEtdy0xNiIgcm9sZT0iaW1nIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBmaWxsPSJjdXJyZW50Q29sb3IiIGQ9Ik00ODcuNCAzMTUuN2wtNDIuNi0yNC42YzQuMy0yMy4yIDQuMy00NyAwLTcwLjJsNDIuNi0yNC42YzQuOS0yLjggNy4xLTguNiA1LjUtMTQtMTEuMS0zNS42LTMwLTY3LjgtNTQuNy05NC42LTMuOC00LjEtMTAtNS4xLTE0LjgtMi4zTDM4MC44IDExMGMtMTcuOS0xNS40LTM4LjUtMjcuMy02MC44LTM1LjFWMjUuOGMwLTUuNi0zLjktMTAuNS05LjQtMTEuNy0zNi43LTguMi03NC4zLTcuOC0xMDkuMiAwLTUuNSAxLjItOS40IDYuMS05LjQgMTEuN1Y3NWMtMjIuMiA3LjktNDIuOCAxOS44LTYwLjggMzUuMUw4OC43IDg1LjVjLTQuOS0yLjgtMTEtMS45LTE0LjggMi4zLTI0LjcgMjYuNy00My42IDU4LjktNTQuNyA5NC42LTEuNyA1LjQuNiAxMS4yIDUuNSAxNEw2Ny4zIDIyMWMtNC4zIDIzLjItNC4zIDQ3IDAgNzAuMmwtNDIuNiAyNC42Yy00LjkgMi44LTcuMSA4LjYtNS41IDE0IDExLjEgMzUuNiAzMCA2Ny44IDU0LjcgOTQuNiAzLjggNC4xIDEwIDUuMSAxNC44IDIuM2w0Mi42LTI0LjZjMTcuOSAxNS40IDM4LjUgMjcuMyA2MC44IDM1LjF2NDkuMmMwIDUuNiAzLjkgMTAuNSA5LjQgMTEuNyAzNi43IDguMiA3NC4zIDcuOCAxMDkuMiAwIDUuNS0xLjIgOS40LTYuMSA5LjQtMTEuN3YtNDkuMmMyMi4yLTcuOSA0Mi44LTE5LjggNjAuOC0zNS4xbDQyLjYgMjQuNmM0LjkgMi44IDExIDEuOSAxNC44LTIuMyAyNC43LTI2LjcgNDMuNi01OC45IDU0LjctOTQuNiAxLjUtNS41LS43LTExLjMtNS42LTE0LjF6TTI1NiAzMzZjLTQ0LjEgMC04MC0zNS45LTgwLTgwczM1LjktODAgODAtODAgODAgMzUuOSA4MCA4MC0zNS45IDgwLTgwIDgweiI+PC9wYXRoPjwvc3ZnPg==">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    <script src="../js/vu.sop.js"></script>
    
    <script>
    vu.sop.load('../').then(
        function() {
            let text = localStorage.getItem('documento');
            document.getElementById('vu.sop.ui.userName').value = text;
            document.getElementById('vu.sop.ui.userName').setAttribute("disabled", "");
            vu.sop.api.headers = {
                'x-access-apikey': '9be36b98-612a-6a25-15c3-a7a7217b8fce'
            };            
            vu.sop.api.host = 'https://compensar.sop.dev.infomediaservice.online/vu-onboarding-rest/';
// Personalizaciones
vu.sop.start = async function() {
// Prepara la camara y librerias para userInput() document()
await vu.sop.steps.loadLibsAndCamera();
// Pantalla de ingreso de usuario
vu.sop.steps.userInput();

await inicio();

try {
        // Graba el proceso de onboarding
        await vu.sop.startRecording();
// Pantallas para subir los documentos
await vu.sop.steps.document();
// instrucciones face
return await instruccionesface();
      
    } catch (e) {
        await vu.sop.stopRecording();
        return new Error(e.message)
    };
};
            vu.sop.start().then(
                function(res) {
                    if (res.identical === true){
                        if(localStorage.getItem('ocrdoc') != localStorage.getItem('documento')){
                                alerta();
                                vu.sop.ui.alert('Autenticaci&oacute;n Exitosa<br>Confianza ' + Math.round(response.confidence*100) + '%' + ' ,pero el documento del registro y de la cedula no coinciden').then(function (res) {
                                    console.log(localStorage.getItem('ocrdoc'));
                                    window.location.reload(false);
                                }) 
                            }else{
                                swal("exito");
                                vu.sop.ui.alert('Autenticaci&oacute;n Exitosa<br>Confianza ' + Math.round(response.confidence*100) + '%').then(function (res) {
                                    console.log(localStorage.getItem('ocrdoc'));
                                    $('#contenido').load('componentes/codigo.html');
                                })  
                            } 

                    } else {
                        vu.sop.ui.alert('Autenticaci&oacute;n Fallida').then(function (res) {
                            window.location.reload(false);
                        })
                    }
                }
            )
        },function(value) {
            console.log('re',value)
        }
    )

async function inicio(){
    vu.sop.ui.user.do();
}

async function instruccionescamara(){
    console.log("entre en instruccionescamara");
    vu.sop.ui.show("instruccionescamara");
    vu.sop.ui.hide("vu.sop.ui.video");
    await $("#btninstruccionescamara").click(async function()
    {
        vu.sop.ui.hide("instruccionescamara");
        vu.sop.ui.hideBottomText();
        vu.sop.ui.show("vu.sop.ui.video");
        await vu.sop.steps.takePictureDocumentFront();
        await vu.sop.steps.takePictureDocumentBack();
        vu.sop.steps.documentPromiseResolve(true)
    });
}

instruccionesface = async function(){
    vu.sop.ui.show("instruccionesface");
    vu.sop.ui.hide("vu.sop.ui.video");
    x=true;
    //while (x == true) {
        try{
            await $("#btninstruccionesface").click(async function(){ 
                vu.sop.ui.hide("instruccionesface");
                vu.sop.ui.show("vu.sop.ui.video");
                // Prepara la camara y librerias para authFace()
                await vu.sop.steps.loadLibsAndCameraFace();
                // Pantalla de autenticacion
                x=false;
                respuesta = await vu.sop.steps.authFace();
                if (respuesta.identical === true){
                        if(localStorage.getItem('ocrdoc') != localStorage.getItem('documento')){
                                alerta();
                                vu.sop.ui.alert('Autenticaci&oacute;n Exitosa<br>Confianza ' + Math.round(response.confidence*100) + '%' + ' ,pero el documento del registro y de la cedula no coinciden').then(function (res) {
                                    console.log(localStorage.getItem('ocrdoc'));
                                    window.location.reload(false);
                                }) 
                            }else{
                                    $('#contenido').load('componentes/codigo.html');
                            } 

                    } else {
                        vu.sop.ui.alert('Autenticaci&oacute;n Fallida').then(function (res) {
                            window.location.reload(false);
                        })
                    }
        });
    } catch (e) {
            await vu.sop.ui.hideWhiteLoading();
            console.log(e)
            await vu.error.showError(new vu.error.CameraError(e.message));
            x = false;
        }
    //}        
    }
    </script>


